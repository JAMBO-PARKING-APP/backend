# Zone Live Status API View\nclass ZoneLiveStatusAjaxView(AdminRequiredMixin, View):\n    def get(self, request, zone_id):\n        try:\n            zone = Zone.objects.get(pk=zone_id)\n            \n            # Get active sessions for this zone\n            active_sessions = ParkingSession.objects.filter(\n                zone=zone,\n                status='active'\n            ).select_related('vehicle', 'slot')\n            \n            # Get all slots for this zone\n            all_slots = zone.slots.all()\n            \n            # Create slot status data\n            slots_data = []\n            occupied_slots = {session.slot_id: session for session in active_sessions if session.slot_id}\n            \n            for slot in all_slots:\n                if slot.id in occupied_slots:\n                    session = occupied_slots[slot.id]\n                    slots_data.append({\n                        'id': slot.slot_code or slot.id,\n                        'status': 'occupied',\n                        'vehicle': session.vehicle.license_plate\n                    })\n                else:\n                    slots_data.append({\n                        'id': slot.slot_code or slot.id,\n                        'status': 'available',\n                        'vehicle': None\n                    })\n            \n            # If no slots defined, create mock slots based on active sessions\n            if not all_slots.exists():\n                # Create slots based on active sessions + some available ones\n                total_slots = max(50, active_sessions.count() * 2)  # At least 50 slots\n                slots_data = []\n                \n                for i in range(1, total_slots + 1):\n                    # Check if this slot number has an active session\n                    session = active_sessions.filter(slot_number=i).first()\n                    if session:\n                        slots_data.append({\n                            'id': i,\n                            'status': 'occupied',\n                            'vehicle': session.vehicle.license_plate\n                        })\n                    else:\n                        slots_data.append({\n                            'id': i,\n                            'status': 'available',\n                            'vehicle': None\n                        })\n            \n            # Prepare active sessions list\n            active_sessions_list = []\n            for session in active_sessions:\n                duration = timezone.now() - session.start_time\n                hours, remainder = divmod(duration.total_seconds(), 3600)\n                minutes, _ = divmod(remainder, 60)\n                \n                active_sessions_list.append({\n                    'vehicle': session.vehicle.license_plate,\n                    'slot': session.slot.slot_code if session.slot else session.slot_number or 'N/A',\n                    'start_time': session.start_time.strftime('%H:%M'),\n                    'duration': f\"{int(hours)}h {int(minutes)}m\" if hours > 0 else f\"{int(minutes)}m\"\n                })\n            \n            occupied_count = len([s for s in slots_data if s['status'] == 'occupied'])\n            total_slots_count = len(slots_data)\n            \n            data = {\n                'zone_name': zone.name,\n                'total_slots': total_slots_count,\n                'occupied_slots': occupied_count,\n                'active_sessions': active_sessions.count(),\n                'slots': slots_data,\n                'active_sessions_list': active_sessions_list\n            }\n            \n            return JsonResponse(data)\n            \n        except Zone.DoesNotExist:\n            return JsonResponse({'error': 'Zone not found'}, status=404)\n        except Exception as e:\n            return JsonResponse({'error': str(e)}, status=500)